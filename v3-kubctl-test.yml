#===========================================================================================================================
#     Demo:         v3-infra-core
#     Description:  Mulitiple GKE Clusters, With Self Managed Istio
#     Pipeline:     GCP Infrastructure Core Pipeline (Manages GKE Clusters, Networking & Istio Service Mesh Install) 
#===========================================================================================================================

#
# v3-infra-core
# AT (Automated Testing) Environment
#
v3-kubectl-test-step-0:
  stage: kubectl-test
  image: gcr.io/tk-automation-1483/time-keeper-cicd:v1.1
  rules:
    #- if: '$CI_PIPELINE_SOURCE == "push"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_BRANCH != "main"'
      when: on_success
      #changes:
        #- /**/*
  script:
    - gcloud container clusters list --project=	tk-v3-lcl-4421
    - gcloud container clusters get-credentials tk-v3-lcl-gke-europe-west6 --region europe-west6 --project 	tk-v3-lcl-4421
    - kubectl get ns
